import e from"path";import t from"fs";import r from"url";import s from"prompts";import i from"cross-spawn";import a from"chalk";import"minimist";import o from"download-git-repo";import c from"ora";const n=(r,s)=>{t.readdirSync(r).forEach((i=>{const a=e.resolve(r,i),o=e.resolve(s,i);t.statSync(a).isDirectory()?(t.mkdirSync(o,{recursive:!0}),n(a,o)):t.copyFileSync(a,o)}))},m="sdc-web",l=c("正在下载，请稍候...");(async()=>{let c=m;const p=await s([{type:"text",name:"projectName",message:"项目名称？",initial:m,onState:e=>{e.value=e.value.trim().replace(/\/+$/g,"")},validate:e=>!!(e=>/^(?:@[a-z\d\-*~][a-z\d\-*._~]*\/)?[a-z\d\-~][a-z\d\-._~]*$/.test(e))(e)||"格式错误，请重新输入"},{type:e=>t.existsSync(e)?"confirm":null,name:"override",message:e=>`项目名称目录${e}已存在，是否覆盖？`},{type:e=>{if(!1===e)throw new Error(a.red("✖ 操作已取消"));return null},name:"overrideChecker"},{type:"text",name:"description",message:"项目描述？",initial:"快速生成项目脚手架.."},{type:"select",name:"framework",message:"选择框架？",choices:()=>[{title:"SDC",value:"sdc"},{title:"Vue",value:"vue"},{title:"React",value:"react"}],initial:0},{type:"select",name:"language",message:e=>"sdc"===e?"选择模板？":"选择开发语言？",choices:e=>{const t=[{title:"JavaScript",value:"js"},{title:"TypeScript",value:"ts"}];return"sdc"===e?[{title:"web",value:"web"},{title:"mobile - 不建议使用",value:"mobile"},{title:"mfe",value:"mfe"}]:("vue"===e&&t.push({title:"Customize with create-vue ↗",value:"custom"}),t)},initial:0}],{onCancel:()=>{throw new Error(a.red("✖ 操作已取消"))}}),{projectName:u,override:d,framework:v,language:f}=p;if(c=u,process.env.npm_config_user_agent,"custom"===f){const e="npm create vue@latest TARGET_DIR".replace("TARGET_DIR",c),[t,...r]=e.split(" "),{status:s}=i.sync(t,r,{stdio:"inherit"});process.exit(s??0)}if("react"===v){const e=("npx create-react-app TARGET_DIR "+("ts"===f?"--template typescript":"")).replace("TARGET_DIR",c),[t,...r]=e.split(" "),{status:s}=i.sync(t,r,{stdio:"inherit"});process.exit(s??0)}const y=e.join(process.cwd(),c);var h;t.existsSync(y)?d&&(h=y,t.readdirSync(h).forEach((r=>{t.rmSync(e.resolve(h,r),{force:!0,recursive:!0})}))):t.mkdirSync(y,{recursive:!0});const g=`template-${v}-${f}`,w=e.resolve(r.fileURLToPath(import.meta.url),"../../","./templates",g);if(l.start(),"sdc"===v){const e={web:"direct:https://git.woa.com/hr-team/nts/SDCFront/sdc-web-app.git#master",mobile:"direct:https://git.woa.com/hr-team/nts/SDCFront/sdc-mob-app.git#master",mfe:"direct:https://git.woa.com/hr-team/nts/SDCFront/sdc-mfe.git#master"}[f];await new Promise(((t,r)=>{o(e,y,{clone:!0},(e=>{e&&(r(e),process.exit()),t()}))}))}else n(w,y);((r,s,i)=>{const{projectName:a,description:o,author:c}=s,n=t.readFileSync(e.resolve(r,"package.json"),"utf8"),m=JSON.parse(n);m.name=a,m.description=o,m.author=c||"liben",t.writeFileSync(e.resolve(r,"package.json"),JSON.stringify(m,null,2),"utf8"),i&&i()})(y,p,(()=>{l.stop()}))})().catch((e=>{l.stop()}));
